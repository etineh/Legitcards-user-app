plugins {
    id "com.android.application"
    // START: FlutterFire Configuration
    id "com.google.gms.google-services"
    // END: FlutterFire Configuration
    id "kotlin-android"
    // The Flutter Gradle Plugin must be applied after the Android and Kotlin Gradle plugins.
    id "dev.flutter.flutter-gradle-plugin"
}

android {
    namespace = "com.legitcardsusers"
    compileSdk = 35  // ← Updated to Android 15 (API 35)
    ndkVersion = "29.0.14033849"  // ← Explicitly set to NDK r26b for 16KB page size

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8
    }

    defaultConfig {
        applicationId = "com.legitcardsusers"
        minSdk = 23
        targetSdk = 35
        versionCode = 16017
        versionName = "1.28.0"

        // Required for new page size support
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a", "x86", "x86_64"
            debugSymbolLevel "FULL"
        }

        // Enable 16KB page size explicitly (important for Play Store)
        externalNativeBuild {
            ndkBuild {
                arguments "-DANDROID_PAGE_SIZE=16384"
            }
        }
    }

    signingConfigs {
        release {
            def keystoreProperties = new Properties()
            def keystorePropertiesFile = rootProject.file("key.properties")
            if (keystorePropertiesFile.exists()) {
                keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
            }
            keyAlias keystoreProperties["keyAlias"]
            keyPassword keystoreProperties["keyPassword"]
            storeFile keystoreProperties["storeFile"] ? file(keystoreProperties["storeFile"]) : null
            storePassword keystoreProperties["storePassword"]
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
            minifyEnabled true      // Shrinks code
            shrinkResources true    // Removes unused resources
            debuggable false
        }
    }

    // Make sure JNI libraries are properly packaged (required for 16KB page support)
    packaging {
        jniLibs {
            useLegacyPackaging false
        }
    }
}

flutter {
    source = "../.."
}



//plugins {
//    id "com.android.application"
//    // START: FlutterFire Configuration
//    id 'com.google.gms.google-services'
//    // END: FlutterFire Configuration
//    id "kotlin-android"
//    // The Flutter Gradle Plugin must be applied after the Android and Kotlin Gradle plugins.
//    id "dev.flutter.flutter-gradle-plugin"
//}
//
//android {
//    namespace = "com.legitcardsusers"
//    compileSdk = 35  // ← Updated
//    ndkVersion = flutter.ndkVersion
//
//    compileOptions {
//        sourceCompatibility = JavaVersion.VERSION_1_8
//        targetCompatibility = JavaVersion.VERSION_1_8
//    }
//
//    kotlinOptions {
//        jvmTarget = JavaVersion.VERSION_1_8
//    }
//
//    defaultConfig {
//        applicationId = "com.legitcardsusers"
//        minSdk = 21  // ← Explicit value (or keep flutter.minSdkVersion)
//        targetSdk = 35  // ← Updated
////        versionCode = flutter.versionCode
//        versionCode = 16012
////        versionName = flutter.versionName
//        versionName "1.23.0"
//        // Add this for 16KB page size support
//        ndk {
//            abiFilters 'armeabi-v7a', 'arm64-v8a', 'x86', 'x86_64'
//        }
//    }
//
//    signingConfigs {
//        release {
//            def keystoreProperties = new Properties()
//            def keystorePropertiesFile = rootProject.file("key.properties")
//            if (keystorePropertiesFile.exists()) {
//                keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
//            }
//            keyAlias keystoreProperties['keyAlias']
//            keyPassword keystoreProperties['keyPassword']
//            storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null
//            storePassword keystoreProperties['storePassword']
////            debug {
////                storeFile file('debug.keystore')
////                storePassword 'android'
////                keyAlias 'androiddebugkey'
////                keyPassword 'android'
////            }
//        }
//    }
//
//    buildTypes {
//        release {
//            signingConfig signingConfigs.release
//            minifyEnabled true  // Reduces app size
//            shrinkResources true    // Removes unused resources
//        }
//    }
//}
//
//flutter {
//    source = "../.."
//}
